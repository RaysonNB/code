<!DOCTYPE html>
<html>
<head>
<title>Maze</title>
<style>
body { margin: 0px; }
#container { position: relative; width: 0; height: 0; }
.cell { position: absolute; background-color: #333; }
.wall { position: absolute; background-color: #000; }
.empty { background-color: #fff; }
.start { background-color: #66f; }
.end { background-color: #696; }
.forward { background-color: #ccf; }
.backward { background-color: #fcc; }
</style>
</head>
<body>
<div id="container"></div>
<script>
var _board_col = 100, _board_row = 50;
var _cell_size = 10, _wall_size = 1;
var _speed = 1, _showSolution = false;
var _board;
var _container;
var _solution;

window.onload = initGame();

function initGame()
{
	initBoard();
	findSolution(_solution, _board, 0, 0, 0);
	setTimeout(function () { showSolution(_solution, 1); }, 3000);
}

function initBoard()
{
	_board_col = Math.min(Math.floor(window.innerWidth / (_cell_size + _wall_size)), 200);
	_board_row = Math.min(Math.floor(window.innerHeight / (_cell_size + _wall_size)), 100);
	
	_container = document.getElementById('container');
	_container.innerHTML = '';
	_container.style['left'] = (window.innerWidth - _board_col * (_cell_size + _wall_size)) / 2 + 'px';
	_container.style['top'] = (window.innerHeight - _board_row * (_cell_size + _wall_size)) / 2 + 'px';
	
	_board = new Array();
	_solution = new Array();
	for (var i = 0; i < _board_row; i++)
	{
		_board.push(new Array());
		for (var j = 0; j < _board_col; j++)
		{
			_board[i].push([0, 0, 0, 0]);
		}
	}
	
	createBoard(_container, _board, _cell_size, _wall_size);
	setEmptyCell(_board, 0, 0, 0);
}

function setWall(wall, type, i, j, cell_size, wall_size)
{
	wall.setAttribute('id', 'wall_' + type + '_' + j + '_' + i);
	wall.setAttribute('x', j);
	wall.setAttribute('y', i);
	wall.setAttribute('class', 'wall');
	if (type == 'x')
	{
		wall.style['width'] = wall_size + 'px';
		wall.style['height'] = cell_size + wall_size * 2 + 'px';
	}
	else
	{
		wall.style['width'] = cell_size + wall_size * 2 + 'px';
		wall.style['height'] = wall_size + 'px';
	}
	wall.style['left'] = cell_size * j + wall_size * (j - 1) + 'px';
	wall.style['top'] = cell_size * i + wall_size * (i - 1) + 'px';
}

function createBoard(container, board, cell_size, wall_size)
{
	for (var i = 0; i < board.length; i++)
	{
		for (var j = 0; j < board[0].length; j++)
		{
			var cell = document.createElement('div');
			cell.setAttribute('id', 'cell_' + j + '_' + i);
			cell.setAttribute('x', j);
			cell.setAttribute('y', i);
			cell.setAttribute('class', 'cell');
			cell.style['width'] = cell_size + 'px';
			cell.style['height'] = cell_size + 'px';
			cell.style['left'] = cell_size * j + wall_size * j + 'px';
			cell.style['top'] = cell_size * i + wall_size * i + 'px';
			container.appendChild(cell);
			
			if (i == 0 && j == 0)
				cell.classList.add('start');
			
			if (i == board.length - 1 && j == board[0].length - 1)
				cell.classList.add('end');
		}
	}
	
	for (var i = 0; i < board.length; i++)
	{
		for (var j = 0; j < board[0].length + 1; j++)
		{
			var wall = document.createElement('div');
			setWall(wall, 'x', i, j, cell_size, wall_size)
			container.appendChild(wall);
		}
	}
	
	for (var i = 0; i < board.length + 1; i++)
	{
		for (var j = 0; j < board[0].length; j++)
		{
			var wall = document.createElement('div');
			setWall(wall, 'y', i, j, cell_size, wall_size);
			container.appendChild(wall);
		}
	}
}

function setEmptyCell(board, x, y, depth)
{
	var cell = document.getElementById('cell_' + x + '_' + y);
	if (cell == null || cell.classList.contains('empty')) return false;
	
	cell.classList.add('empty');
	
	var offsets = [[0, -1], [0, 1], [-1, 0], [1, 0]];
	for (var i = 0; i < offsets.length; i++)
	{
		var rand = Math.floor(Math.random() * offsets.length);
		var temp = offsets[i];
		offsets[i] = offsets[rand];
		offsets[rand] = temp;
	}
	
	for (var i = 0; i < offsets.length; i++)
	{
		var new_x = x + offsets[i][0];
		var new_y = y + offsets[i][1];
		if (new_x < 0 || new_y < 0 || new_x >= board[0].length || new_y >= board.length) continue;
		if (setEmptyCell(board, new_x, new_y, depth + 1))
		{
			var wall;
			if (offsets[i][0] == 0)
			{
				var temp = (offsets[i][1] + 1) / 2;
				wall = document.getElementById('wall_y_' + x + '_' + (y + offsets[i][1] + 1 - temp));
				board[y][x][temp] = 1;
			} 
			else if (offsets[i][1] == 0)
			{
				var temp = (offsets[i][0] + 1) / 2;
				wall = document.getElementById('wall_x_' + (x + offsets[i][0] + 1 - temp) + '_' + y);
				board[y][x][temp + 2] = 1;
			}
			wall.style['display'] = 'none';
		}
	}
	
	return true;
}

function findSolution(solution, board, x, y, depth)
{
	var cell = document.getElementById('cell_' + x + '_' + y);
	if (cell == null || !cell.classList.contains('empty')) return false;
	if (cell.classList.contains('end')) return true;

	var offsets = new Array();
	if (board[y][x][3] == 1) offsets.push([1, 0]);
	if (board[y][x][1] == 1) offsets.push([0, 1]);
	if (board[y][x][0] == 1) offsets.push([0, -1]);
	if (board[y][x][2] == 1) offsets.push([-1, 0]);
	
	for (var i = 0; i < offsets.length; i++)
	{
		if (_showSolution) cell.innerHTML = '*';
		solution.push([x, y, 1]);
		
		var new_x = x + offsets[i][0];
		var new_y = y + offsets[i][1];
		var flag = findSolution(solution, board, new_x, new_y, depth + 1);
		if (flag) return flag;
	}
	
	cell.innerHTML = '';
	solution.push([x, y, 0]);
}

function showSolution(solution, index)
{
	for (var i = 0; i < _speed; i++)
	{
		var x = solution[index][0];
		var y = solution[index][1];
		var cell = document.getElementById('cell_' + x + '_' + y);
		if (cell == null) break;
		
		if (solution[index][2] == 1)
			cell.classList.add('forward');
		else
			cell.classList.add('backward');
		
		index++;
		if (index >= solution.length) 
		{
			setTimeout('initGame()', 5000);
			return;
		}
	}
	setTimeout(function () { showSolution(solution, index); }, 50);
}

</script>
</body>
</html>