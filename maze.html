<!DOCTYPE html>
<html>
<head>
<title>Maze</title>
<meta charset="UTF-8">
<style>
body { margin: 0px; }
#container { position: relative; width: 0; height: 0; }
.cell { position: absolute; background-color: #000; font-size: 8px; text-align: center; }
.wall { position: absolute; background-color: #000; }
.empty { background-color: #000; }
.start { background-color: #33f!important; color: #fff; }
.end { background-color: #f33!important; }
.forward { background-color: #ccf!important; }
.backward { background-color: #fcc!important; }
.white { background-color: #fff; }
</style>
</head>
<body>
<div id="container"></div>
<script>
var _board_col = 100, _board_row = 50;
var _cell_size = 20, _wall_size = 3;
var _speed = 10, _showSolution = false;
var _sx = 0, _sy = 0;
var _ex = 0, _ey = 0;
var _board;
var _container;
var _solution;
var _steps;

window.onload = initGame();

function initGame()
{
	initBoard();
	findSolution(_solution, _board, _sx, _sy, 0);
	
	showSteps(_steps, 0);
}

function initBoard()
{
	_board_col = Math.min(Math.floor(window.innerWidth / (_cell_size + _wall_size)), 100);
	_board_row = Math.min(Math.floor(window.innerHeight / (_cell_size + _wall_size)), 100);
	_sx = Math.floor(Math.random() * _board_col);
	_sy = Math.floor(Math.random() * _board_row);
	_ex = Math.floor(Math.random() * _board_col);
	_ey = Math.floor(Math.random() * _board_row);
	
	_container = document.getElementById('container');
	_container.innerHTML = '';
	_container.style['left'] = (window.innerWidth - _board_col * (_cell_size + _wall_size)) / 2 + 'px';
	_container.style['top'] = (window.innerHeight - _board_row * (_cell_size + _wall_size)) / 2 + 'px';
	
	_steps = new Array();
	_board = new Array();
	_solution = new Array();
	for (var i = 0; i < _board_row; i++)
	{
		_board.push(new Array());
		for (var j = 0; j < _board_col; j++)
		{
			_board[i].push([0, 0, 0, 0]);
		}
	}
	
	createBoard(_container, _board, _cell_size, _wall_size);
	setEmptyCell(_steps, _board, _sx, _sy, 0);
}

function setWall(wall, type, i, j, cell_size, wall_size)
{
	wall.setAttribute('id', 'wall_' + type + '_' + j + '_' + i);
	wall.setAttribute('x', j);
	wall.setAttribute('y', i);
	wall.setAttribute('class', 'wall');
	if (type == 'x')
	{
		wall.style['width'] = wall_size + 'px';
		wall.style['height'] = cell_size + wall_size * 2 + 'px';
	}
	else
	{
		wall.style['width'] = cell_size + wall_size * 2 + 'px';
		wall.style['height'] = wall_size + 'px';
	}
	wall.style['left'] = cell_size * j + wall_size * (j - 1) + 'px';
	wall.style['top'] = cell_size * i + wall_size * (i - 1) + 'px';
}

function createBoard(container, board, cell_size, wall_size)
{
	for (var i = 0; i < board.length; i++)
	{
		for (var j = 0; j < board[0].length; j++)
		{
			var cell = document.createElement('div');
			cell.setAttribute('id', 'cell_' + j + '_' + i);
			cell.setAttribute('x', j);
			cell.setAttribute('y', i);
			cell.setAttribute('class', 'cell');
			cell.style['width'] = cell_size + 'px';
			cell.style['height'] = cell_size + 'px';
			cell.style['left'] = cell_size * j + wall_size * j + 'px';
			cell.style['top'] = cell_size * i + wall_size * i + 'px';
			cell.style['line-height'] = cell_size + 'px';
			container.appendChild(cell);
			
			if (i == _sy && j == _sx)
				cell.classList.add('start');
			
			if (i == _ey && j == _ex)
				cell.classList.add('end');
		}
	}
	
	for (var i = 0; i < board.length; i++)
	{
		for (var j = 0; j < board[0].length + 1; j++)
		{
			var wall = document.createElement('div');
			setWall(wall, 'x', i, j, cell_size, wall_size)
			container.appendChild(wall);
		}
	}
	
	for (var i = 0; i < board.length + 1; i++)
	{
		for (var j = 0; j < board[0].length; j++)
		{
			var wall = document.createElement('div');
			setWall(wall, 'y', i, j, cell_size, wall_size);
			container.appendChild(wall);
		}
	}
}

function setEmptyCell(steps, board, x, y, depth)
{
	var cell = document.getElementById('cell_' + x + '_' + y);
	if (cell == null || cell.classList.contains('empty')) return false;
	
	_steps.push(cell);
	cell.classList.add('empty');
	
	var offsets = [[0, -1], [0, 1], [-1, 0], [1, 0]];
	for (var i = 0; i < offsets.length; i++)
	{
		var rand = Math.floor(Math.random() * offsets.length);
		var temp = offsets[i];
		offsets[i] = offsets[rand];
		offsets[rand] = temp;
	}
	
	for (var i = 0; i < offsets.length; i++)
	{
		var new_x = x + offsets[i][0];
		var new_y = y + offsets[i][1];
		if (new_x < 0 || new_y < 0 || new_x >= board[0].length || new_y >= board.length) continue;
		if (document.getElementById('cell_' + new_x + '_' + new_y).classList.contains('empty')) continue;
		
		var wall;
		if (offsets[i][0] == 0)
		{
			var temp = (offsets[i][1] + 1) / 2;
			wall = document.getElementById('wall_y_' + x + '_' + (y + offsets[i][1] + 1 - temp));
			board[y][x][temp] = 1;
		} 
		else if (offsets[i][1] == 0)
		{
			var temp = (offsets[i][0] + 1) / 2;
			wall = document.getElementById('wall_x_' + (x + offsets[i][0] + 1 - temp) + '_' + y);
			board[y][x][temp + 2] = 1;
		}
		_steps.push(wall);

		setEmptyCell(steps, board, new_x, new_y, depth + 1);
	}
	
	return true;
}

function findSolution(solution, board, x, y, depth)
{
	var cell = document.getElementById('cell_' + x + '_' + y);
	if (cell == null || !cell.classList.contains('empty')) return false;
	if (cell.classList.contains('end')) return true;

	var offsets = new Array();
	if (solution.length == 0 || solution[solution.length - 1][3][0] == 0)
	{
		if (_ex > _sx)
		{
			if (board[y][x][3] == 1) offsets.push([1, 0]);
			if (board[y][x][2] == 1) offsets.push([-1, 0]);
		}
		else 
		{
			if (board[y][x][2] == 1) offsets.push([-1, 0]);
			if (board[y][x][3] == 1) offsets.push([1, 0]);
		}
		
		if (_ey > _sy)
		{
			if (board[y][x][1] == 1) offsets.push([0, 1]);
			if (board[y][x][0] == 1) offsets.push([0, -1]);
		}
		else 
		{
			if (board[y][x][0] == 1) offsets.push([0, -1]);
			if (board[y][x][1] == 1) offsets.push([0, 1]);
		}
	}
	else
	{
		if (_ey > _sy)
		{
			if (board[y][x][1] == 1) offsets.push([0, 1]);
			if (board[y][x][0] == 1) offsets.push([0, -1]);
		}
		else 
		{
			if (board[y][x][0] == 1) offsets.push([0, -1]);
			if (board[y][x][1] == 1) offsets.push([0, 1]);
		}
		
		if (_ex > _sx)
		{
			if (board[y][x][3] == 1) offsets.push([1, 0]);
			if (board[y][x][2] == 1) offsets.push([-1, 0]);
		}
		else 
		{
			if (board[y][x][2] == 1) offsets.push([-1, 0]);
			if (board[y][x][3] == 1) offsets.push([1, 0]);
		}
	}
	
	/*
	if (board[y][x][3] == 1) offsets.push([1, 0]);
	if (board[y][x][1] == 1) offsets.push([0, 1]);
	if (board[y][x][0] == 1) offsets.push([0, -1]);
	if (board[y][x][2] == 1) offsets.push([-1, 0]);
	for (var i = 0; i < offsets.length; i++)
	{
		var rand = Math.floor(Math.random() * offsets.length);
		var temp = offsets[i];
		offsets[i] = offsets[rand];
		offsets[rand] = temp;
	}
	*/
	
	for (var i = 0; i < offsets.length; i++)
	{
		if (_showSolution) cell.innerHTML = depth % 1000;
		solution.push([x, y, 1, offsets[i]]);
		
		var new_x = x + offsets[i][0];
		var new_y = y + offsets[i][1];
		var flag = findSolution(solution, board, new_x, new_y, depth + 1);
		if (flag) return flag;
	}
	
	cell.innerHTML = '';
	solution.push([x, y, 0, [0, 0]]);
}

function showSolution(solution, index)
{
	for (var i = 0; i < _speed; i++)
	{
		var x = solution[index][0];
		var y = solution[index][1];
		var cell = document.getElementById('cell_' + x + '_' + y);
		if (cell == null) break;
		
		if (solution[index][2] == 1)
		{
			if (index > 0)
				cell.classList.add('forward');
				
			if (solution[index][3][0] == 0)
			{
				if (solution[index][3][1] == 1)
					cell.innerHTML = '&#129123;';
				else if (solution[index][3][1] == -1)
					cell.innerHTML = '&#129121;';
			}
			else if (solution[index][3][1] == 0)
			{
				if (solution[index][3][0] == 1)
					cell.innerHTML = '&#129122;';
				else if (solution[index][3][0] == -1)
					cell.innerHTML = '&#129120;';
			}
		}
		else
		{
			cell.classList.add('backward');
			cell.innerHTML = '';
		}
		
		index++;
		if (index >= solution.length) 
		{
			setTimeout('initGame()', 10000);
			return;
		}
	}
	setTimeout(function () { showSolution(solution, index); }, 50);
}

function showSteps(steps, index)
{
	for (var i = 0; i < _speed * 10; i++)
	{
		var obj = steps[index];
		if (obj == null) break;
		
		if (obj.classList.contains('empty'))
			obj.classList.add('white');
		else 
			obj.style['display'] = 'none';
		index++;
		
		if (index >= steps.length)
		{
			showSolution(_solution, 0);
			return;
		}
	}
	setTimeout(function () { showSteps(steps, index); }, 4);
}

</script>
</body>
</html>